# Phase 8 완료 보고서: 설정 UI 및 시스템 트레이 개발

**PM: Manus**  
**Date: 2026-01-28**  
**Status: ✅ 완료**

---

## 완료 항목

### 1. 설정 창 (SettingsWindow) ✅

#### SettingsWindow (`gui/settings_window.py`)
사용자가 모든 설정을 변경할 수 있는 설정 창을 구현했습니다.

**주요 기능:**
- 4개 탭 구조 (일반, 테마, 성능, 오디오)
- 실시간 설정 미리보기
- 적용/확인/취소 버튼

**탭 구성:**

#### 1) 일반 탭
- **창 설정**
  - Always on top 체크박스
  - Click through 체크박스
  - 창 투명도 슬라이더 (10-100%)
- **시작 설정**
  - 자동 시작 체크박스
  - 최소화 시 트레이로 체크박스

#### 2) 테마 탭
- **테마 선택**
  - 드롭다운으로 테마 선택
  - 테마 설명 표시
- **폰트 설정**
  - 한국어 폰트 선택 버튼
  - 영어 폰트 선택 버튼
  - 폰트 미리보기
- **색상 설정**
  - 한국어 색상 선택 버튼
  - 영어 색상 선택 버튼
  - 색상 미리보기

#### 3) 성능 탭
- **성능 프로필**
  - 경량 (CPU, 빠른 시작)
  - 표준 (GPU, 고품질)
  - 프로필 설명
- **고급 설정**
  - 오디오 청크 크기 (1-10초)
  - VAD 필터 체크박스

#### 4) 오디오 탭
- **오디오 디바이스**
  - 입력 디바이스 드롭다운
  - 새로고침 버튼
- **샘플레이트**
  - 16000 Hz (권장)
  - 44100 Hz
  - 48000 Hz

**특징:**
- **QTabWidget**: 탭 기반 UI
- **QFontDialog**: 폰트 선택 다이얼로그
- **QColorDialog**: 색상 선택 다이얼로그
- **콜백 패턴**: `on_settings_changed` 콜백으로 설정 적용

### 2. 시스템 트레이 (SystemTray) ✅

#### SystemTray (`gui/system_tray.py`)
시스템 트레이 아이콘과 메뉴를 구현했습니다.

**주요 기능:**
- 트레이 아이콘 표시
- 우클릭 메뉴
- 더블클릭 시 창 표시
- 알림 메시지

**메뉴 구성:**
- **시작**: 자막 생성 시작
- **중지**: 자막 생성 중지
- **창 표시**: 자막 창 표시
- **설정**: 설정 창 열기
- **종료**: 프로그램 종료

**시그널:**
- `start_requested`: 시작 요청
- `stop_requested`: 중지 요청
- `settings_requested`: 설정 요청
- `show_window_requested`: 창 표시 요청
- `quit_requested`: 종료 요청

**특징:**
- **QSystemTrayIcon**: Qt 시스템 트레이
- **QMenu**: 컨텍스트 메뉴
- **pyqtSignal**: 이벤트 기반 통신
- **상태 관리**: 시작/중지 버튼 활성화 제어

### 3. 애플리케이션 통합 ✅

#### LiveCaptionApp 업데이트 (`gui/app.py`)
설정 창과 시스템 트레이를 메인 애플리케이션에 통합했습니다.

**추가된 기능:**
- `show_settings()`: 설정 창 표시
- `_on_settings_changed()`: 설정 변경 콜백
- `_connect_tray_signals()`: 트레이 시그널 연결
- `_on_start_requested()`: 트레이에서 시작 요청
- `_on_stop_requested()`: 트레이에서 중지 요청
- `_on_settings_requested()`: 트레이에서 설정 요청
- `_on_show_window_requested()`: 트레이에서 창 표시 요청
- `_on_quit_requested()`: 트레이에서 종료 요청

**설정 적용 흐름:**
```
[SettingsWindow] 사용자가 설정 변경
     ↓
[적용 버튼 클릭]
     ↓
[_collect_settings()] 설정 수집
     ↓
[on_settings_changed 콜백]
     ↓
[LiveCaptionApp._on_settings_changed()]
     ↓
[설정 적용]
  - 테마 변경
  - 창 설정 변경
  - 성능 프로필 변경
     ↓
[트레이 알림 표시]
```

**트레이 통합 흐름:**
```
[SystemTray] 사용자가 메뉴 클릭
     ↓
[pyqtSignal 발생]
     ↓
[LiveCaptionApp 슬롯 호출]
     ↓
[해당 동작 실행]
     ↓
[트레이 상태 업데이트]
     ↓
[알림 메시지 표시]
```

---

## 아키텍처 다이어그램

### 설정 시스템 구조

```
┌─────────────────────────────────────────┐
│      User Interface                     │
│                                         │
│  ┌──────────────────────────────┐      │
│  │   SettingsWindow             │      │
│  │  - 4개 탭 (일반/테마/성능/오디오)  │      │
│  │  - 적용/확인/취소            │      │
│  └──────────────────────────────┘      │
│         ↓ on_settings_changed          │
└─────────────────────────────────────────┘
         ↓
┌─────────────────────────────────────────┐
│      Application Layer                  │
│                                         │
│  ┌──────────────────────────────┐      │
│  │   LiveCaptionApp             │      │
│  │  - _on_settings_changed()    │      │
│  └──────────────────────────────┘      │
│         ↓                               │
│  ┌──────────────┐  ┌──────────────┐   │
│  │CaptionWindow │  │CaptionController│   │
│  │(테마/창 설정) │  │(성능 프로필)   │   │
│  └──────────────┘  └──────────────┘   │
└─────────────────────────────────────────┘
```

### 시스템 트레이 구조

```
┌─────────────────────────────────────────┐
│      System Tray                        │
│                                         │
│  ┌──────────────────────────────┐      │
│  │   SystemTray                 │      │
│  │  - QSystemTrayIcon           │      │
│  │  - QMenu                     │      │
│  └──────────────────────────────┘      │
│         ↓ pyqtSignal                   │
└─────────────────────────────────────────┘
         ↓
┌─────────────────────────────────────────┐
│      Application Layer                  │
│                                         │
│  ┌──────────────────────────────┐      │
│  │   LiveCaptionApp             │      │
│  │  - _on_start_requested()     │      │
│  │  - _on_stop_requested()      │      │
│  │  - _on_settings_requested()  │      │
│  │  - _on_show_window_requested()│      │
│  │  - _on_quit_requested()      │      │
│  └──────────────────────────────┘      │
└─────────────────────────────────────────┘
```

---

## 사용자 시나리오

### 시나리오 1: 테마 변경

```
1. 트레이 아이콘 우클릭 → "설정"
2. "테마" 탭 선택
3. 드롭다운에서 "투명 오버레이" 선택
4. "적용" 버튼 클릭
5. 자막 창이 투명 오버레이로 변경됨
6. 트레이 알림: "테마가 'transparent'으로 변경되었습니다"
```

### 시나리오 2: 성능 프로필 변경

```
1. 설정 창 → "성능" 탭
2. 프로필을 "경량"에서 "표준"으로 변경
3. "적용" 버튼 클릭
4. 경고: "성능 프로필 변경은 재시작이 필요합니다"
5. 프로그램 재시작
6. GPU 기반 고품질 모드로 실행
```

### 시나리오 3: 트레이에서 제어

```
1. 자막 창 닫기 → 트레이로 최소화
2. 트레이 아이콘 우클릭 → "시작"
3. 자막 생성 시작
4. 트레이 알림: "자막 생성이 시작되었습니다"
5. 트레이 아이콘 더블클릭 → 창 표시
6. 트레이 우클릭 → "중지"
7. 자막 생성 중지
```

---

## 기술적 결정사항

### 1. 탭 기반 설정 UI
- **이유**: 설정 항목이 많아 분류 필요
- **장점**: 직관적, 확장 용이
- **단점**: 없음

### 2. 콜백 패턴
- **이유**: 설정 변경 시 애플리케이션에 알림
- **장점**: 느슨한 결합, 확장 가능
- **단점**: 없음

### 3. pyqtSignal 사용
- **이유**: Qt 이벤트 기반 통신
- **장점**: 스레드 안전, 표준 Qt 패턴
- **단점**: 없음

### 4. setQuitOnLastWindowClosed(False)
- **이유**: 창 닫아도 트레이에서 실행 유지
- **장점**: 백그라운드 실행 가능
- **단점**: 명시적 종료 필요

### 5. QFontDialog, QColorDialog
- **이유**: Qt 표준 다이얼로그 사용
- **장점**: 일관된 UI, 크로스 플랫폼
- **단점**: 없음

---

## 코드 품질

### 1. 시그널/슬롯 패턴
```python
class SystemTray(QObject):
    start_requested = pyqtSignal()
    
self.system_tray.start_requested.connect(self._on_start_requested)
```

### 2. 콜백 패턴
```python
self.settings_window.on_settings_changed = self._on_settings_changed
```

### 3. 상태 관리
```python
def set_running_state(self, is_running: bool):
    self.start_action.setEnabled(not is_running)
    self.stop_action.setEnabled(is_running)
```

### 4. 리소스 정리
```python
def cleanup(self):
    if self.system_tray:
        self.system_tray.hide()
```

---

## 다음 단계 (Phase 9)

### 통합 테스트 및 성능 최적화

1. **통합 테스트**
   - 전체 파이프라인 테스트
   - 실제 오디오 입력 테스트
   - 테마 전환 테스트
   - 설정 변경 테스트

2. **성능 최적화**
   - 메모리 사용량 최적화
   - CPU 사용률 최적화
   - 지연시간 측정 및 개선
   - 스레드 동기화 최적화

3. **버그 수정**
   - 엣지 케이스 처리
   - 에러 핸들링 강화
   - 로그 추가

4. **사용자 경험 개선**
   - 로딩 인디케이터
   - 에러 메시지 개선
   - 도움말 추가

---

## 예상 소요 시간

- **Phase 8 실제 소요**: 1.5시간 ✅
- **Phase 9 예상 소요**: 2-3시간

---

## 이슈 및 해결

### 이슈 1: 트레이 아이콘 이미지
**문제**: 기본 아이콘 없음

**해결**:
- TODO로 표시
- 실제 배포 시 아이콘 파일 추가 필요

### 이슈 2: 성능 프로필 변경
**문제**: 런타임에 모델 변경 어려움

**해결**:
- 재시작 필요 메시지 표시
- 향후 핫 스왑 기능 추가 고려

---

## PM 코멘트

Phase 8이 성공적으로 완료되었습니다. **설정 UI와 시스템 트레이**가 추가되어, 이제 사용자가 프로그램을 쉽게 제어하고 커스터마이징할 수 있게 되었습니다.

**핵심 성과:**
- ✅ 설정 창 (4개 탭) 구현
- ✅ 시스템 트레이 구현
- ✅ 설정 변경 콜백 시스템
- ✅ 트레이 시그널/슬롯 통합
- ✅ 알림 메시지 지원
- ✅ 백그라운드 실행 지원

다음 Phase 9에서는 전체 시스템을 통합 테스트하고 성능을 최적화하여, Windows 실행 파일 패키징을 준비하겠습니다.

**진행 상태: 8/11 단계 완료 (73%)**

---

**PM: Manus**  
**Next Phase: 9. 통합 테스트 및 성능 최적화**
